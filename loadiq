#!/usr/bin/env bash
#
# Simple wrapper to run the LoadIQ CLI without installing the package.

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

export PYTHONPATH="${PYTHONPATH:-}${PYTHONPATH:+:}${SCRIPT_DIR}/src"

PYTHON_BIN="${PYTHON:-}"

if [[ -z "${PYTHON_BIN}" ]]; then
    if [[ -n "${VIRTUAL_ENV:-}" && -x "${VIRTUAL_ENV}/bin/python" ]]; then
        PYTHON_BIN="${VIRTUAL_ENV}/bin/python"
    elif [[ -x "${SCRIPT_DIR}/.venv/bin/python" ]]; then
        PYTHON_BIN="${SCRIPT_DIR}/.venv/bin/python"
    elif command -v python3 >/dev/null 2>&1; then
        PYTHON_BIN="$(command -v python3)"
    elif command -v python >/dev/null 2>&1; then
        PYTHON_BIN="$(command -v python)"
    else
        echo "Error: Python interpreter not found. Activate the virtual environment or install Python." >&2
        exit 1
    fi
fi

if [[ ! -x "${PYTHON_BIN}" ]]; then
    echo "Error: Python interpreter '${PYTHON_BIN}' is not executable." >&2
    exit 1
fi

exec "${PYTHON_BIN}" -m loadiq.cli.app "$@"
